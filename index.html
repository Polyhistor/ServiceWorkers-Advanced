<!DOCTYPE html>
<title>First service worker</title>
<h1>Sericer worker test</h1>
<output></output>

<button onclick="update()">Update check</button>

<script>

    function update() {
        if('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistration().then(registration => {
                console.log(registration)
                registration.update()
            })
        }
    }

    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('serviceWorker.js', {
            scope: "/"
        }).then( 
        registration => {
            console.log(registration)
            const scope = registration.scope
            document.querySelector('output').innerHTML = `Service worker registered properly at ${scope}` 
        }).catch(error => {
            document.querySelector('output').innerHTML = "Service worker not registered"
        })
    } else {
        document.querySelector('output').innerHTML = "Service worker not available"
    }

    if ('serviceWorker' in navigator) {
        console.log('here 2')
        navigator.serviceWorker.getRegistration().
            then(registration => {
                console.log('yo')
                registration.addEventListener('updatefound ', e => {
                    const swInstalling = registration.installing
                    console.log('here 1')
                    swInstalling.addEventListener('statechange', ()=> {
                        if (swInstalling.state === 'installed') {
                                // your logic on installed state, you can inform the user here
                            document.querySelector('output').innerHTML = "a new service worker is installed and waiting"
                        } else {
                            document.querySelector('output').innerHTML = "the new service worker is now controlling the page"
                        }
                    })
                })
        }).catch(e=> {})
    }
  
</script>